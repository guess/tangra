<html>
    <head>
        <title>Public API Test Site</title>    
        <script src="jquery-2.1.1.min.js"></script>
        
    </head>

    <h1>Tangra test website</h1>
    
    <p>Welcome to Tangra test website. This is for testing out the data sending
    ability of the public API.</p>
    
    <p>Before using this website, please keep these in mind:
        <ul>
            <li>Use only with test databases.</li>
            <li>Must have the server running at http://127.0.0.1:8000 before the test.</li>
            <li>Restart the browser if you have entered http://127.0.0.1:8000 before hand.</li>
        </ul>
    </p>

    <p>Start out by giving a credential of a user.</p>    
    
    <div id='CredentialFormDiv'>
        <form onsubmit="return false">
        Username: <input type='text' id='UserName'/>
        Password: <input type='text' id='Password'/>
        <button id='SubmitCredential'>Submit</button>
        </form>
    </div>

    <div id='DataFormDiv'>
        <p>Then, fill in the form and try to submit the data.</p>
        <form id='DataForm' onsubmit="return false">
            Text: <input type='text' id='Data'/>
            <button id='SubmitData'>Submit</button>
        </form>
    </div>
    
    <script>
        window.token = 0;
        
        $("#DataFormDiv").hide();
        
        $("#SubmitCredential").click(function() {
            var username = $("#UserName").val();
            var password = $("#Password").val();
            
            $.ajax({
                async: false,
                data:'get=token',
                url:"http://127.0.0.1:8000/api/",
                headers: {'Authorization': 'Basic ' + btoa(username +':'+ password)},
                success:function(data) { 
                    window.token=data['token'];
                    alert("You have obtained the token: " + window.token);
                },
                error:function(jqXHR) {
                    $("html").html($.parseHTML(jqXHR.responseText));
                }
            });
            
            $("#DataFormDiv").show(1000);
            $("#CredentialFormDiv").hide(1000);
            
        });
        
        $("#SubmitData").click(function() {
            d = new Date();
            formatted_date = "2013-05-14 16:30";
            
            $.ajax({
                async: false,
                data: JSON.stringify({
                    'datum':$("#Data").val(), 
                    'user_stage':1, 
                    'timestamp': formatted_date}),
                url:"http://127.0.0.1:8000/api/",
                headers: {'Authorization': 'Token ' + window.token},
                success:function(data) { 
                    alert("You have sent over the data successfully!");
                },
                contentType:"application/json",
                type:"POST",
                error:function(jqXHR) {
                   $("html").html($.parseHTML(jqXHR.responseText));
                }
            });
        });
    </script>
</html>